# Main task file for nginx server role
- name: install nginx
  apt: name=nginx update_cache=yes state=present

- name: install apache2-utils
  apt: name=apache2-utils state=present

- name: create password file
  command: htpasswd -cb /etc/nginx/.htpasswd boundless Open4Test!

- name: create default site config
  copy: src=nginx.conf dest=/etc/nginx/sites-available/default

- name: install fcgiwrap
  apt: name=fcgiwrap state=present

- name: restart fcgiwrap
  service: name=fcgiwrap state=started

- name: run fcgiwrap update
  command: update-rc.d fcgiwrap enable

- name: make cgi dir
  file: path=/usr/share/nginx/cgi state=directory mode=777

- name: make www .ssh dir
  file: path=/var/www/.ssh state=directory mode=777 owner=www-data

- name: move python1.cgi into nginx/cgi folder
  copy: src=Python1.cgi dest=/usr/share/nginx/cgi/ mode=777

- name: install svn
  apt: name=subversion state=latest

- name: get basic website files
  subversion: repo=https://github.com/boundlessgeo/SuiteQAAutomation/trunk/robot/reports force=yes export=yes username=boundlessQA password=QA4Good! dest=/usr/share/nginx/html

- name: update html mod
  command: chmod 777 /usr/share/nginx/html

- name: update data.json mod
  command: chmod 777 /usr/share/nginx/html/data.json

- name: restart nginx
  service: name=nginx state=restarted
