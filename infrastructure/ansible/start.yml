- hosts: all_boxes
  gather_facts: false
  tasks:
  - name: start AWS instances
    local_action:
      module: ec2
      state: 'running'
      region: us-east-1
      instance_ids: "{{ hostvars[inventory_hostname]['ec2_id'] }}"

- hosts: tag_type_hub
  gather_facts: false
  tasks:
  - name: wait for hub machine to be up
    local_action: wait_for port=22 host="{{ ansible_ssh_host | default(inventory_hostname) }}" search_regex=OpenSSH delay=30 timeout=300

- hosts: tag_type_hub
  gather_facts: false
  remote_user: ec2-user
  sudo: yes
  tasks:
  - name: start selenium hub
    docker: 
      docker_api_version: 1.21
      name: selenium-hub
      image: selenium/hub:2.52.0
      ports: 4444:4444
      state: started

